<!DOCTYPE html>
<html><head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>ScoreBoard and Tomasulo Alogorithm - ZonePG</title><meta name="viewport" content="width=device-width, initial-scale=1">

	<meta property="og:image" content=""/>
	<meta property="og:title" content="ScoreBoard and Tomasulo Alogorithm" />
<meta property="og:description" content="ScoreBoard 和 Tomasulo 算法是体系结构中 指令级并行(ILP: Instruction Level Parallelism) 内容必磕的两个算法。
ScoreBoard Algorithm 记分板体系结构 首先让我们看一看 ScoreBoard 的三个部件：
Instruction status: which of 4 steps the instruction is in Instruction status Functional unit status: Indicates the state of the functional unit (FU). 9 fields for each functional unit Busy—Indicates whether the unit is busy or not Op—Operation to perform in the unit (e.g., &#43; or –) Fi—Destination register Fj, Fk—Source-register numbers Qj, Qk—Functional units producing source registers Fj, Fk (理解为 Fj，Fk 在 Register result status 中的 functional unit，即某个 functional unit 占用 Fj 或者 Fk) Rj, Rk—Flags indicating when Fj, Fk are ready Functional unit status Register result status—Indicates which functional unit will write each register, if one exists." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zonepg.github.io/posts/programming/ca/2021-04-15-scoreboarding-tomasulo/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-04-15T00:00:00+00:00" />
<meta property="article:modified_time" content="2021-04-15T00:00:00+00:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="ScoreBoard and Tomasulo Alogorithm"/>
<meta name="twitter:description" content="ScoreBoard 和 Tomasulo 算法是体系结构中 指令级并行(ILP: Instruction Level Parallelism) 内容必磕的两个算法。
ScoreBoard Algorithm 记分板体系结构 首先让我们看一看 ScoreBoard 的三个部件：
Instruction status: which of 4 steps the instruction is in Instruction status Functional unit status: Indicates the state of the functional unit (FU). 9 fields for each functional unit Busy—Indicates whether the unit is busy or not Op—Operation to perform in the unit (e.g., &#43; or –) Fi—Destination register Fj, Fk—Source-register numbers Qj, Qk—Functional units producing source registers Fj, Fk (理解为 Fj，Fk 在 Register result status 中的 functional unit，即某个 functional unit 占用 Fj 或者 Fk) Rj, Rk—Flags indicating when Fj, Fk are ready Functional unit status Register result status—Indicates which functional unit will write each register, if one exists."/>
<script src="https://zonepg.github.io/js/feather.min.js"></script>
	
	<link href="https://zonepg.github.io/css/fonts.css" rel="stylesheet">
	
	<link rel="stylesheet" type="text/css" media="screen" href="https://zonepg.github.io/css/main.css" />
	
</head>
<body>
        <div class="content"><header>
	<div class="main">
		<a href="https://zonepg.github.io/">ZonePG</a>
	</div>
	<nav>
		
	</nav>
	
</header>

<main>
	<article>
		<div class="title">
			<h1 class="title">ScoreBoard and Tomasulo Alogorithm</h1>
			<div class="meta">Posted on Apr 15, 2021</div>
		</div>
		

		<section class="body">
			<p><code>ScoreBoard</code> 和 <code>Tomasulo</code> 算法是体系结构中 <strong>指令级并行(ILP: Instruction Level Parallelism)</strong> 内容必磕的两个算法。</p>
<h2 id="scoreboard-algorithm">ScoreBoard Algorithm</h2>
<figure><img src="/ca/2021-04-15-scoreboarding-tomasulo/2021-04-15-scoreboarding-tomasulo-1.png"/><figcaption>
            <h4>记分板体系结构</h4>
        </figcaption>
</figure>

<p>首先让我们看一看 ScoreBoard 的三个部件：</p>
<ul>
<li><strong>Instruction status</strong>: which of 4 steps the instruction is in
<figure><img src="/ca/2021-04-15-scoreboarding-tomasulo/2021-04-15-scoreboarding-tomasulo-2.png"/><figcaption>
            <h4>Instruction status</h4>
        </figcaption>
</figure>
</li>
<li><strong>Functional unit status</strong>: Indicates the state of the <strong>functional unit (FU)</strong>. 9 fields for each functional unit
<ul>
<li><strong>Busy</strong>—Indicates whether the unit is busy or not</li>
<li><strong>Op</strong>—Operation to perform in the unit (e.g., + or –)</li>
<li><strong>Fi</strong>—Destination register</li>
<li><strong>Fj, Fk</strong>—Source-register numbers</li>
<li><strong>Qj, Qk</strong>—Functional units producing source registers Fj, Fk (理解为 Fj，Fk 在 <code>Register result status</code> 中的 <code>functional unit</code>，即某个 <code>functional unit</code> 占用 Fj 或者 Fk)</li>
<li><strong>Rj, Rk</strong>—Flags indicating when Fj, Fk are ready
<figure><img src="/ca/2021-04-15-scoreboarding-tomasulo/2021-04-15-scoreboarding-tomasulo-3.png"/><figcaption>
            <h4>Functional unit status</h4>
        </figcaption>
</figure>
</li>
</ul>
</li>
<li><strong>Register result status</strong>—Indicates which functional unit will write each register, if one exists. Blank when no pending instructions will write that register
<figure><img src="/ca/2021-04-15-scoreboarding-tomasulo/2021-04-15-scoreboarding-tomasulo-4.png"/><figcaption>
            <h4>Register result status</h4>
        </figcaption>
</figure>
</li>
</ul>
<p>看过ScoreBoard 的部件设计图后，我们来了解一下它的设计思想：</p>
<h3 id="overview">Overview</h3>
<h4 id="基本思想">基本思想</h4>
<ul>
<li>Use <code>scoreboard</code> to track data (RAW) dependence through register (使用 <code>ScoreBoard</code> 追踪寄存器间的 <strong>RAW</strong> 数据相关。)</li>
</ul>
<h4 id="主要的设计思想">主要的设计思想</h4>
<ul>
<li>Instructions are sent to FU unit if there is no outstanding name dependence. (如果指令没有名称冲突，则将指令送到 FU)</li>
<li>RAW data dependence is tracked and enforced by scoreboard. (RAW 数据相关会被 Scoreboard 追踪)</li>
<li>Register values are passed through the register file; a child instruction starts execution after the
last parent finishes execution. (寄存器值通过寄存器文件传递，父指令执行完后子指令开始执行)</li>
<li>Pipeline stalls if any name dependence (WAR or WAW) is detected. (如果检测到 WAR，WAW冲突，冲突的两个指令中，执行顺序中应当后执行的指令的流水线会暂停)</li>
</ul>
<h3 id="算法执行步骤">算法执行步骤</h3>
<ol>
<li>Issue—decode instructions &amp; check for structural hazards
<ul>
<li>No Wait conditions: (1) the required FU is free; (2) no other instruction writes to the same register destination (to avoid <strong>WAW</strong>)</li>
<li>Actions: (1) the instruction proceeds to the FU; (2) scoreboard updates its internal data structure</li>
<li>If an instruction is stalled at this stage, no other instructions can proceed</li>
</ul>
</li>
<li>Read operands—wait until no data hazards, then read operands
<ul>
<li>Wait conditions: all source operands are available</li>
<li>Actions: the function unit reads register operands and start execution the next cycle</li>
<li>The scoreboard resolves <strong>RAW</strong> hazards. dynamically in this step, and <strong>instructions may be sent into execution out of order</strong></li>
</ul>
</li>
<li>Execution—operate on operands (EX)
<ul>
<li>Actions: The functional unit begins execution upon receiving operands. When the result is ready, it notifies the scoreboard that it has completed execution.</li>
</ul>
</li>
<li>Write result—finish execution (WB)
<ul>
<li>Wait condition: no other instruction/FU is going to read the register destination of the instruction</li>
<li>Actions: Write the register and update the scoreboard</li>
<li>the scoreboard checks for <strong>WAR</strong> hazards. If none, it writes results. If WAR , then it stalls the instructions</li>
</ul>
</li>
</ol>
<h3 id="example">Example</h3>
<p><del>算法执行步骤可能有点复杂，不要担心，</del>在<code>YouTube</code>上找到一个十分直观的例子来理解上述算法执行步骤，结合这个例子，可以帮助理解算法执行步骤。

<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube.com/embed/TJcNJh8tS6w" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>
</p>
<h2 id="tomasulo-algorithm">Tomasulo Algorithm</h2>
<figure><img src="/ca/2021-04-15-scoreboarding-tomasulo/2021-04-15-scoreboarding-tomasulo-5.png"/><figcaption>
            <h4>Tomasulo架构图</h4>
        </figcaption>
</figure>

<p>Tomasulo 算法是 ScoreBoard算法的改进</p>
<h3 id="overview-1">Overview</h3>
<h4 id="基本思想-1">基本思想</h4>
<ul>
<li>消除指令执行过程中的数据相关</li>
<li>指令调度过程中引入 <code>tag-broadcasting</code></li>
</ul>
<h4 id="主要的设计思想-1">主要的设计思想</h4>
<ul>
<li><strong>功能缓冲部件</strong>称为了保留站(reservation stations)，用来存放计算的操作数。</li>
<li>指令中的寄存器被数值或者指向保留站的指针代替，这一过程称为：<strong>寄存器换名(register renaming)</strong>
<ul>
<li>消除 <strong>WAR，WAW</strong> 冒险</li>
<li>保留站比实际寄存器多，可以完成编译器不能完成的优化工作</li>
</ul>
</li>
<li>结果从保留站直通 FU，无需通过寄存器，而是通过公共数据总线（Common Data Bus）把结果广播到所有的 FU</li>
<li>装入（Load）和存储（Stores）也像其他部件一样具有保留站（专门的缓冲器）</li>
</ul>
<h3 id="保留站组成部分">保留站组成部分</h3>
<ul>
<li><strong>Op</strong>—Operation to perform in the unit (e.g., + or –)</li>
<li><strong>Qj, Qk</strong>—Reservation stations producing source registers (value to be written)</li>
<li><strong>Vj, Vk</strong>—Value of Source operands</li>
<li><strong>Rj, Rk</strong>—Flags indicating when Vj, Vk are ready</li>
<li><strong>Busy</strong>—Indicates reservation station and FU is busy</li>
<li><strong>Register result status</strong>—Indicates which functional unit will write each register, if one exists. Blank when no pending instructions that will write that register.</li>
</ul>
<h3 id="算法执行步骤-1">算法执行步骤</h3>
<ol>
<li>Issue—get instruction from FP Op Queue
<ul>
<li>If reservation station free (<strong>no structural hazard</strong>), the scoreboard issues instr &amp; sends operands (<strong>renames registers</strong>, solve <strong>WAR</strong> <strong>WAW</strong>)</li>
</ul>
</li>
<li>Execution—operate on operands (EX)
<ul>
<li>When both operands ready then execute; (solve <strong>RAW</strong>)</li>
<li>if not ready, watch CDB for result</li>
</ul>
</li>
<li>Write result—finish execution (WB)
<ul>
<li>Write on Common Data Bus to all awaiting units;</li>
<li>mark reservation station available</li>
</ul>
</li>
</ol>
<ul>
<li>Normal bus: data + destination</li>
<li>Common Data Bus: data + source</li>
<li>Normal = &ldquo;Go To&rdquo; bus; CDB = &ldquo;Come From&rdquo; bus</li>
</ul>
<h3 id="example-1">Example</h3>
<p><del>可能看的还是有些晕乎，不要担心，</del>还是结合直观的例子来帮助理解算法执行步骤。

<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube.com/embed/EfwCfhXxNnI" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>
</p>
<h3 id="扩展阅读">扩展阅读</h3>
<p>知乎上看到<a href="https://zhuanlan.zhihu.com/p/139241174">理解现代处理器：指令级并行篇</a>，从“从数据流动态分析”的角度理解指令集并内容更加直观</p>
<h2 id="reference">Reference</h2>
<ul>
<li><a href="http://users.utcluj.ro/~sebestyen/_Word_docs/Cursuri/SSC_course_5_Scoreboard_ex.pdf">Lecture 6: Scoreboarding and Tomasulo Algorithm</a></li>
<li><a href="https://www.youtube.com/watch?v=TJcNJh8tS6w">High Performance Computer Architecture - Scoreboarding Example</a></li>
<li><a href="https://people.eecs.berkeley.edu/~pattrsn/252F96/Lecture04.pdf">berkeley Lecture 4: Tomasulo Algorithm and Dynamic Branch Prediction</a></li>
<li>合肥工业大学体系结构课程lecture——08b-Exploiting ILP</li>
<li><a href="https://zhuanlan.zhihu.com/p/139241174">理解现代处理器：指令级并行篇</a></li>
</ul>

		</section>

		<div class="post-tags">
			
			
			<nav class="nav tags">
				<ul class="tags">
					
					<li><a href="/tags/computer-architecture">Computer Architecture</a></li>
					
				</ul>
			</nav>
			
			
		</div>
	</article>
</main>
<footer>
<hr>

<a class="soc" href="https://github.com/zonepg" title="GitHub"><i data-feather="github"></i></a>|<a class="soc" href="https://zonepg.github.io/posts/index.xml" title="RSS"><i data-feather="rss"></i></a>|⚡️
	2023  @ ZonePG |  <a href="https://github.com/athul/archie">Archie Theme</a> | Built with <a href="https://gohugo.io">Hugo</a>
</footer>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-0RR9DVCNMR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-0RR9DVCNMR');
</script>
<script>
      feather.replace()
</script></div>
    </body>
</html>
